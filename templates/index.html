<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ad-Free Music Player</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#111; color:#fff; }
    #player { width:100%; background:#000; padding:20px; text-align:center; }
    audio { width:80%; outline:none; }
    #searchBar { width:70%; padding:10px; margin:10px auto; display:block; border-radius:5px; border:none; }
    #songs { padding:20px; max-height:400px; overflow-y:auto; }
    .song { padding:10px; margin:5px 0; background:#222; border-radius:5px; cursor:pointer; }
    .song:hover { background:#444; }
    #loadMore { padding:10px 20px; background:#28a745; color:#fff; border:none; border-radius:5px; cursor:pointer; margin:20px auto; display:block; }
  </style>
</head>
<body>
  <div id="player">
    <h2 id="nowPlaying">Select a Song</h2>
    <audio id="audioPlayer" controls autoplay></audio>
  </div>

  <input type="text" id="searchBar" placeholder="Search songs...">

  <div id="songs"></div>
  <button id="loadMore">Load More</button>

  <script>
    let currentPage = 1;
    let currentQuery = "";
    const songsDiv = document.getElementById("songs");
    const nowPlaying = document.getElementById("nowPlaying");
    const audioPlayer = document.getElementById("audioPlayer");

    async function fetchSongs(reset=false) {
      let url = `/songs?page=${currentPage}`;
      if (currentQuery) url += `&q=${encodeURIComponent(currentQuery)}`;

      const res = await fetch(url);
      const data = await res.json();

      if (reset) songsDiv.innerHTML = "";

      data.forEach(song => {
        const div = document.createElement("div");
        div.className = "song";
        div.textContent = song.title;
        div.onclick = () => {
          audioPlayer.src = song.url;
          nowPlaying.textContent = "Now Playing: " + song.title;
          audioPlayer.play();
        };
        songsDiv.appendChild(div);
      });
    }

    document.getElementById("loadMore").onclick = () => {
      currentPage++;
      fetchSongs();
    };

    document.getElementById("searchBar").addEventListener("keyup", e => {
      if (e.key === "Enter") {
        currentQuery = e.target.value;
        currentPage = 1;
        fetchSongs(true);
      }
    });

    fetchSongs(true);
  </script>
</body>
</html>
