<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>YouTube Player Proxy</title>
<style>
  body { font-family: Arial; text-align: center; padding: 20px; }
  iframe { width: 100%; max-width: 720px; height: 405px; margin-top: 20px; }
  button { margin: 5px; padding: 10px 20px; }
</style>
</head>
<body>

<h1>YouTube Player Proxy</h1>
<input type="text" id="yturl" placeholder="Paste YouTube URL here" size="50">
<button onclick="loadVideo()">Load</button>

<div id="playerContainer" style="display:none;">
    <h2 id="title"></h2>
    <div id="videoWrapper"></div>
    <button onclick="prevVideo()">Previous</button>
    <button onclick="nextVideo()">Next</button>
</div>

<script>
let playlist = [];
let currentIndex = 0;

async function loadVideo() {
    const url = document.getElementById("yturl").value;
    if (!url) return alert("Please paste a YouTube URL");

    const res = await fetch("/get_video", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url })
    });
    const data = await res.json();
    if (data.error) return alert(data.error);

    playlist = [data.current].concat(data.next_videos);
    currentIndex = 0;
    showVideo(currentIndex);
}

function showVideo(index) {
    if (!playlist[index]) return;
    const v = playlist[index];
    document.getElementById("playerContainer").style.display = "block";
    document.getElementById("title").innerText = v.title;

    const wrapper = document.getElementById("videoWrapper");
    wrapper.innerHTML = `<iframe src="https://www.youtube.com/embed/${v.id}?autoplay=1" 
        frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
}

function nextVideo() {
    if (currentIndex + 1 < playlist.length) {
        currentIndex++;
        showVideo(currentIndex);
    }
}

function prevVideo() {
    if (currentIndex - 1 >= 0) {
        currentIndex--;
        showVideo(currentIndex);
    }
}
</script>

</body>
</html>
