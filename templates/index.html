<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ad-Free YouTube Player</title>
    <style>
        body { font-family: Arial; background: #111; color: #fff; text-align: center; }
        video { width: 80%; margin-top: 20px; }
        input { width: 60%; padding: 10px; margin-top: 20px; }
        button { padding: 10px 20px; margin-left: 10px; cursor: pointer; }
        .controls { margin-top: 10px; }
    </style>
</head>
<body>
    <h1>Ad-Free YouTube Player</h1>
    <input type="text" id="videoUrl" placeholder="Enter YouTube link">
    <button onclick="loadVideo()">Play</button>

    <div class="controls">
        <button onclick="prevVideo()">Prev</button>
        <button onclick="nextVideo()">Next</button>
    </div>

    <video id="player" controls autoplay></video>

    <script>
        let playlist = [];
        let currentIndex = 0;

        function loadVideo() {
            const url = document.getElementById("videoUrl").value;
            fetch("/get_video", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ url })
            })
            .then(res => res.json())
            .then(data => {
                if(data.error) { alert(data.error); return; }
                playlist.push(data);
                currentIndex = playlist.length - 1;
                playCurrent();
            });
        }

        function playCurrent() {
            const video = playlist[currentIndex];
            const player = document.getElementById("player");
            // Get best available mp4 format
            const formats = video.streams.filter(f => f.mimeType.includes("video/mp4"));
            if(formats.length === 0) { alert("No playable format found"); return; }
            player.src = formats[0].url;
            player.play();
        }

        function nextVideo() {
            if(currentIndex + 1 < playlist.length) {
                currentIndex++;
                playCurrent();
            } else {
                alert("No more videos in playlist");
            }
        }

        function prevVideo() {
            if(currentIndex - 1 >= 0) {
                currentIndex--;
                playCurrent();
            } else {
                alert("This is the first video");
            }
        }
    </script>
</body>
</html>
